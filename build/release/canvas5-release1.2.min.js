/*
* @author sergix / http://sergix.visualstudio.net/
*/

/*
* Canvas5 release1.2 Minimized Full Script
* (c) 2016 Sergix
*/

/*
* Compiled using the Closure Compiler
* Copyright 2009 The Closure Compiler Authors / https://github.com/bonami-cz/closure-compiler/
*/

console.info("Canvas5 JavaScript Engine; version release1.2; (c) 2016 Sergix");
function Scene(b){this.domElement=b;this.canvas=this.domElement.getElementById("CanvasGame");this.context=this.canvas.getContext("2d");this.width=this.canvas.width;this.height=this.canvas.height;this.sprites=[];this.actionList=[];this.changeColorList=[0,0,0,0];this.colorList=[null,null,null,null];this.background=this.playerSprite=this.imageData=null;this.backgroundColor="white";this.showInfo=!1;this.modifyColors=function(a,c){if(void 0===a.r)return console.error("Color set must be of type RGBASet! {modifyColors(), "+
a+"}"),0;this.changeColorList[0]=a.r;this.changeColorList[1]=a.g;this.changeColorList[2]=a.b;this.changeColorList[3]=a.a;this.imageData=this.context.getImageData(c[0],c[1],c[2],c[3]);200<this.imageData.width&&200<this.imageData.height&&console.warn("Pixel manipulation on large parts of the canvas can cause major framerate issues! {modifyColors(), null}");var b,d,e,f,g,i,j;for(i=0;i<c[3];i++)for(j=0;j<c[2];j++)b=4*(j+i*this.imageData.width),d=this.imageData.data[b],e=this.imageData.data[b+1],f=this.imageData.data[b+
2],g=this.imageData.data[b+3],d+=this.changeColorList[0],e+=this.changeColorList[1],f+=this.changeColorList[2],g+=this.changeColorList[3],255<d&&(d=255),0>d&&(d=0),255<e&&(e=255),0>e&&(e=0),255<f&&(f=255),0>f&&(f=0),255<g&&(g=255),0>g&&(g=0),this.colorList[0]=d,this.colorList[1]=e,this.colorList[2]=f,this.colorList[3]=g,this.imageData.data[b]=d,this.imageData.data[b+1]=e,this.imageData.data[b+2]=f,this.imageData.data[b+3]=g;this.context.putImageData(this.imageData,c[0],c[1])};this.getColors=function(){return this.colorList};
this.newAction=function(a,c){this.actionList.push({condition:a,action:c})};this.add=function(a){this.sprites.push(a)};this.remove=function(a){a=this.sprites.indexOf(a);-1<a&&this.sprites.splice(a,1)};this.setPlayerSprite=function(a){this.playerSprite=a};var a,c;this.update=function(){for(a=0;a<this.sprites.length;a++){null!==this.playerSprite.boundaries&&(0>this.playerSprite.x&&(this.playerSprite.x=0),this.playerSprite.x+this.playerSprite.width>this.playerSprite.boundaries.width&&(this.playerSprite.x=
this.playerSprite.boundaries.width-this.playerSprite.width),0>this.playerSprite.y&&(this.playerSprite.y=0),this.playerSprite.y+this.playerSprite.height>this.playerSprite.boundaries.height&&(this.playerSprite.y=this.playerSprite.boundaries.height-this.playerSprite.height));var b=this.sprites[a];b.collide&&(this.playerSprite.x<b.x+b.width&&this.playerSprite.x+this.playerSprite.width>b.x&&this.playerSprite.y<b.y+b.height&&this.playerSprite.y+this.playerSprite.height>b.y)&&(0<this.playerSprite.vx?(this.playerSprite.moveLeft=
!1,this.playerSprite.moveDown&&this.playerSprite.moveUp&&(this.playerSprite.x=b.x-this.playerSprite.width)):0>this.playerSprite.vx?(this.playerSprite.moveRight=!1,this.playerSprite.x=b.x+b.width):0<this.playerSprite.vy?(this.playerSprite.moveDown=!1,this.playerSprite.y=b.y-this.playerSprite.height):0>this.playerSprite.vy?(this.playerSprite.moveUp=!1,this.playerSprite.y=b.y+b.height):(this.playerSprite.moveLeft=!0,this.playerSprite.moveRight=!0,this.playerSprite.moveDown=!0,this.playerSprite.moveUp=
!0))}for(a=0;a<this.sprites.length;a++)if(this.sprites[a].collide){null!==this.sprites[a].boundaries&&(0>this.sprites[a].x&&(this.sprites[a].x=0),this.sprites[a].x+this.sprites[a].width>this.sprites[a].boundaries.width&&(this.sprites[a].x=this.sprites[a].boundaries.width-this.sprites[a].width),0>this.sprites[a].y&&(this.sprites[a].y=0),this.sprites[a].y+this.sprites[a].height>this.sprites[a].boundaries.height&&(this.sprites[a].y=this.sprites[a].boundaries.height-this.sprites[a].height));for(c=0;c<
this.sprites.length&&b.collide;c++)a!==c&&(b=this.sprites[a],this.sprites[a].x<b.x+b.width&&(this.sprites[a].x+this.sprites[a].width>b.x&&this.sprites[a].y<b.y+b.height&&this.sprites[a].y+this.sprites[a].height>b.y)&&(0<this.sprites[a].vx?(this.sprites[a].moveLeft=!1,this.sprites[a].x=b.x-this.sprites[a].width):this.sprites[a].moveLeft=!0,0>this.sprites[a].vx?(this.sprites[a].moveRight=!1,this.sprites[a].x=b.x+b.width):this.sprites[a].moveRight=!0,0<this.sprites[a].vy?(this.sprites[a].moveDown=!1,
this.sprites[a].y=b.y-this.sprites[a].height):this.sprites[a].moveDown=!0,0>this.sprites[a].vy?(this.sprites[a].moveUp=!1,this.sprites[a].y=b.y+b.height):this.sprites[a].moveUp=!0))}};this.render=function(b){this.update();null!==this.background?this.context.drawImage(this.background.image,0,0,this.width,this.height):(this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height));for(a=0;a<this.sprites.length;a++)this.sprites[a].update(this.context,b);this.playerSprite.update(this.context,
b);this.showInfo&&(this.context.font="13pt sans-serif",this.context.color="black",this.context.fillText(b+" FPS; "+(this.sprites.length+1)+" objects",10,20));for(a=0;a<this.actionList.length;a++)this.actionList[a].condition()&&this.actionList[a].action()}}
function Sprite(b){this.ay=this.ax=this.vy=this.vx=this.speed=this.y=this.x=0;this.canMove=!0;this.oldY=this.oldX=0;this.image=void 0!==b?b:null;this.width=null===this.image?0:this.image.image.width;this.height=null===this.image?0:this.image.image.height;this.boundaries=null;this.collide=!0;this.spriteSheet=this.name=null;this.frame=0;this.changeFrame=!0;this.activeKeys=[];this.moveUp=this.moveDown=this.moveRight=this.moveLeft=!0;this.mousePositionY=this.mousePositionX=0;this.clicked=!1;this.activeButtons=
[];this.isKeyPressed=function(a){return-1<this.activeKeys.indexOf(a)?1:0};this.isButtonPressed=function(a){return-1<this.activeButtons.indexOf(a)?1:0};this.near=function(a,b){return distance(this.x,this.y,a.x,a.y)<=b?1:0};this.setName=function(a){this.name=a};this.setPosition=function(a,b){this.x=a;this.y=b};this.setVelocity=function(a,b){this.vx=a;this.vy=b};this.setAccel=function(a,b){this.ax=a;this.ay=b};this.addBasicControls=function(a,b){this.speed=a;b.addEventListener("keydown",bind(this,this.onKeyDown),
!1);b.addEventListener("keyup",bind(this,this.onKeyUp),!1)};this.addMouseListener=function(a){a.addEventListener("mousemove",bind(this,this.onMouseMove),!1);a.addEventListener("mousedown",bind(this,this.onMouseDown),!1)};this.onMouseMove=function(a){this.mousePositionX=a.pageX;this.mousePositionY=a.pageY};this.onMouseDown=function(a){switch(a.button){case 0:this.mousePositionX>=this.x&&(this.mousePositionX<=this.x+this.width&&this.mousePositionY>=this.y&&this.mousePositionY<=this.y+this.width)&&(this.clicked=
!0)}this.activeButtons.push(a.button)};this.onMouseUp=function(a){a=this.activeButtons.indexOf(a.button);-1<a&&this.activeButtons.splice(a,1);this.clicked=!1};this.onKeyDown=function(a){switch(a.keyCode){case 38:this.vy=-this.speed;break;case 87:this.vy=-this.speed;break;case 37:this.vx=-this.speed;break;case 65:this.vx=-this.speed;break;case 40:this.vy=this.speed;break;case 83:this.vy=this.speed;break;case 39:this.vx=this.speed;break;case 68:this.vx=this.speed}this.activeKeys.push(a.keyCode)};this.onKeyUp=
function(a){switch(a.keyCode){case 38:this.vy=0;break;case 87:this.vy=0;break;case 37:this.vx=0;break;case 65:this.vx=0;break;case 40:this.vy=0;break;case 83:this.vy=0;break;case 39:this.vx=0;break;case 68:this.vx=0}a=this.activeKeys.indexOf(a.keyCode);-1<a&&this.activeKeys.splice(a,1)};this.update=function(a,b){null===this.spriteSheet&&(this.spriteSheet=new SpriteSheet([this.image]));0===this.width&&0===this.height&&(this.width=this.spriteSheet.images[0].image.width,this.height=this.spriteSheet.images[0].image.height);
!this.moveLeft&&0<this.vx?this.vx=0:this.moveLeft=!0;!this.moveRight&&0>this.vx?this.vx=0:this.moveRight=!0;!this.moveDown&&0<this.vy?this.vy=0:this.moveDown=!0;!this.moveUp&&0>this.vy?this.vy=0:this.moveUp=!0;this.x+=this.vx/b;this.y+=this.vy/b;this.vx+=this.ax/b;this.vy+=this.vy/b;this.changeFrame&&(this.frame+=1);this.frame===this.spriteSheet.images.length&&(this.frame=0);this.draw(a)};this.draw=function(a){a.drawImage(this.spriteSheet.images[this.frame].image,this.x,this.y);if(null===this.name)return 1;
this.name.x=this.x;this.name.y=this.y-25;this.name.draw(a)}}function Rectangle(b,a){this.vy=this.vx=this.y=this.x=0;this.width=b;this.height=a;this.border=this.color="white";this.borderWidth=2;this.setPosition=function(a,b){this.x=a;this.y=b};this.update=function(a,b){this.x+=this.vx/b;this.y+=this.vy/b;this.draw(a)};this.draw=function(a){a.fillStyle=this.color;a.strokeStyle=this.border;a.fillRect(this.x,this.y,this.width,this.height);a.strokeRect(this.x,this.y,this.width,this.height)}}
function Circle(b){this.vy=this.vx=this.y=this.x=0;this.radius=b;this.border=this.color="white";this.borderWidth=2;this.setPosition=function(a,b){this.x=a;this.y=b};this.update=function(a,b){this.x+=this.vx/b;this.y+=this.vy/b;this.draw(a)};this.draw=function(a){a.fillStyle=this.color;a.strokeStyle=this.border;a.lineWidth=this.borderWidth;a.beginPath();a.arc(this.x,this.y,this.radius,0,2*Math.PI,!0);a.closePath();a.fill();a.stroke()}}
function Client(b){this.url=b;server=new WebSocket(b);currentData=null;this.event=function(a){currentData=a};this.sendMessage=function(a){server.send(a)};this.getMessage=function(){return currentData.data};this.setup=function(){console.warn("Canvas5 WebSocket implementation is currently very limited and buggy!");server.onopen=this.event;server.onclose=this.event;server.onmessage=this.event;server.onerror=this.event};this.setup()}
function LocalStorageSet(){this.keyList=[];this.newItem=function(b,a){localStorage.setItem(b,a);this.keyList.push(b)};this.getItem=function(b){return localStorage.getItem(b)};this.getAllItems=function(){var b=[],a;for(a=0;a<this.keyList.length;a++)b.push(localStorage.getItem(this.keyList[a]));return b};this.clear=function(){var b,a;for(a=0;a<this.keyList.length;a++)localStorage.removeItem(this.keyList[a]),b=this.keyList.indexOf(this.keyList[a]),this.keyList.splice(b,1)}}
function AudioElement(b,a){this.domElement=b.createElement("audio");this.src=a;this.play=function(){this.domElement.play()};this.pause=function(){this.domElement.pause()};this.stop=function(){this.pause();this.setTime(0)};this.setTime=function(a){this.domElement.currentTime=a};this.setVolume=function(a){this.domElement.volume=a};this.setup=function(){this.domElement.setAttribute("src",this.src)};this.setup()}
function MessageBox(b,a,c){this.x=void 0!==a?a:0;this.y=void 0!==c?c:0;this.text=b;this.font="12pt sans-serif";this.color="black";this.alwaysActive=!1;this.update=function(a){!1!==this.alwaysActive&&this.draw(a)};this.active=function(a){this.draw(a.context)};this.draw=function(a){a.fillStyle=this.color;a.font=this.font;a.fillText(this.text,this.x,this.y)}}function GameImage(b){this.image=new Image;this.src=b;this.image.src=this.src}function SpriteSheet(b){this.images=b}
function RGBSet(b,a,c){this.r=b;this.g=a;this.b=c;this.a=255;this.getAsString=function(){return"rgb("+this.r+","+this.g+","+this.b+")"}}function RGBASet(b,a,c,h){this.r=b;this.g=a;this.b=c;this.a=h;this.getAsString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+(1<this.a?1:this.a)+")"}}function HSLSet(b,a,c){this.h=b;this.s=a;this.l=c;this.a=255;this.getAsString=function(){return"hsl("+this.r+","+this.g+","+this.b+","+(1<this.a?1:this.a)+")"}}
function HSLASet(b,a,c,h){this.h=b;this.s=a;this.l=c;this.a=h;this.getAsString=function(){return"hsla("+this.r+","+this.g+","+this.b+","+(1<this.a?1:this.a)+")"}}function distance(b,a,c,h){b=c-b;a=h-a;return Math.sqrt(b*b+a*a)}function bind(b,a){return function(){a.apply(b,arguments)}};
